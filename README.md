# FlyingGOAT

## Запуск

1. Зайти в терминале в эту папку (`FlyingGOAT`):

    ```bash
    cd FlyingGOAT
    ```

2. Если не установлены библиотеки, то установить их:

    ```bash
    pip install -r requirements.txt
    ```

3. Зайти через терминал на дроны (это нужно, чтобы добавить их в известные хосты):

    ```bash
    ssh pi@192.168.0.10
    ssh pi@192.168.0.20
    ```

4. Запустить бэкенд:

    ```bash
    python -m fastapi run src/main.py
    ```

5. Зайти на фронтенд:

    Открыть в браузере файл [front.html](front.html) (находится в этой же папке)

## Функционал

Статусы соединения, готовности и уровень батареи появляются с задержкой ~15 секунд, не надо перезагружать страницу.

Лучше запускать дроны при уровне батареи больше 80% (так как полет занимает 4-5 минут).

Зависание картинки с дронов означает, что они остановили их отправку, не надо перезагружать страницу.

Запуск дрона производится по кнопке "Запуск полетного задания". Он копирует файлы на дрон и запускает программы в качестве background процессов. Это занимает некоторое количество времени. Не надо спамить на эту кнопку.

Посадка дрона во время выполнения задания производится по кнопке "Посадка". Он отправляет сигнал на посадку и останавливает запущенную программу. Необходимо нажать один раз (не надо спамить).

Пауза дрона во время выполнения задания производится по кнопке "Пауза". Он отправляет сигнал о приостановке выполнения задания. Это занимает некоторое количество времени (не надо спамить). Они зависают в воздухе, чтобы возобновить выполнение задания, нажмите кнопку "Возобновить".

По окончании полета (после посадки), можно нажать на кнопку "Получить результаты", чтобы получить список координат очагов возгорания и их площади. Появится всплывающее окно.

Для экстренного выключения, то есть, дизарма дрона в воздухе, можно нажать кнопку "Экстренное выключение". Он отправит сигнал о дизарме дронов и они упадут на пол.

## Дисклеймер

Программы для полета запускаются на дронах в качестве background процессов.
В случае перехвата управления дроном перед следующим полетом в OFFBOARD, следует:

- либо перезагрузить дроны:

    1. Отключить аккумулятор для дрона №1
    2. Подождать секунду
    3. Подключить аккумулятор для дрона №1
    4. Повторить для дрона №2

- либо убить эти процессы:

    1. Подключиться к дрону №1:

        ```bash
        ssh pi@192.168.0.10
        ```

    2. Убить процесс:

        ```bash
        pkill -9 -f "python3 to_copter/.*"
        ```

    3. Повторить тоже самое для дрона №2 (`192.168.0.20`)
